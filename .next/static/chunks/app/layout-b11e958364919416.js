(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1558:function(e,t,a){Promise.resolve().then(a.bind(a,912)),Promise.resolve().then(a.bind(a,1481)),Promise.resolve().then(a.t.bind(a,3054,23)),Promise.resolve().then(a.bind(a,8043)),Promise.resolve().then(a.bind(a,1228)),Promise.resolve().then(a.bind(a,3313))},912:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}});let r=a(5592);function n(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return a}},1481:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return i}});let r=a(7437),n=a(8512);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,n.getExpectedRequestStore)("next/dynamic css"),i=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));i.push(...t)}}return 0===i.length?null:(0,r.jsx)(r.Fragment,{children:i.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},8043:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(7437),n=a(2265);let i="tracks",o="meta",s="order";function l(){return new Promise((e,t)=>{let a=indexedDB.open("escuelaAudio",1);a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(o)||e.createObjectStore(o,{keyPath:"key"})},a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}function u(e,t,a){return e.transaction(t,a)}async function c(e){let t=await l(),a=[];return await new Promise((r,n)=>{let l=u(t,[i,o],"readwrite");l.objectStore(i).clear(),l.objectStore(o).put({key:s,order:[]});let c=l.objectStore(i);Array.from(e).forEach(e=>{let t={name:e.name,blob:e,createdAtISO:new Date().toISOString()},r=c.add(t);r.onsuccess=()=>{let e=r.result;a.push(e)}}),l.oncomplete=()=>r(),l.onabort=()=>n(l.error),l.onerror=()=>n(l.error)}),await new Promise(async(e,t)=>{let r=u(await l(),[o],"readwrite");r.objectStore(o).put({key:s,order:a}),r.oncomplete=()=>e(),r.onabort=()=>t(r.error),r.onerror=()=>t(r.error)}),(await d()).map(e=>({id:e.id,name:e.name,url:URL.createObjectURL(e.blob)}))}async function d(){let e=await l(),t=await new Promise(t=>{let a=u(e,[o],"readonly").objectStore(o).get(s);a.onsuccess=()=>{var e;return t(null===(e=a.result)||void 0===e?void 0:e.order)},a.onerror=()=>t(void 0)}),a=u(e,[i],"readonly").objectStore(i),r=e=>new Promise(t=>{let r=a.get(e);r.onsuccess=()=>t(r.result),r.onerror=()=>t(void 0)});if(t&&t.length){let e=[];for(let a of t){let t=await r(a);t&&e.push(t)}return e}return new Promise(e=>{let t=[],r=a.openCursor();r.onsuccess=()=>{let a=r.result;a?(t.push(a.value),a.continue()):e(t)},r.onerror=()=>e(t)})}function m(e){if(!Number.isFinite(e)||e<0)return"0:00";let t=Math.floor(e%60).toString().padStart(2,"0");return"".concat(Math.floor(e/60),":").concat(t)}function f(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),[a,i]=(0,n.useState)([]),[o,s]=(0,n.useState)(0),[l,u]=(0,n.useState)(!1),[f,b]=(0,n.useState)(0),[p,h]=(0,n.useState)(0),[w,g]=(0,n.useState)(!1),[y,x]=(0,n.useState)(1),[k,S]=(0,n.useState)(!1),v=(0,n.useMemo)(()=>a[o],[a,o]);(0,n.useEffect)(()=>{try{let e=localStorage.getItem("audio:hidden");"1"===e&&g(!0);let t=localStorage.getItem("audio:volume");t&&x(Math.max(0,Math.min(1,Number(t))));let a=localStorage.getItem("audio:muted");a&&S("1"===a)}catch(e){}},[]),(0,n.useEffect)(()=>{try{localStorage.setItem("audio:hidden",w?"1":"0")}catch(e){}},[w]),(0,n.useEffect)(()=>{try{localStorage.setItem("audio:volume",String(y))}catch(e){}},[y]),(0,n.useEffect)(()=>{try{localStorage.setItem("audio:muted",k?"1":"0")}catch(e){}},[k]),(0,n.useEffect)(()=>{(async()=>{try{let e=await d();if(e&&e.length){let t=e.map(e=>({id:e.id,name:e.name,url:URL.createObjectURL(e.blob)}));i(t),s(0)}}catch(e){}})()},[]),(0,n.useEffect)(()=>{let t=e.current;t&&(t.volume=Number.isFinite(y)?Math.max(0,Math.min(1,y)):1,t.muted=!!k)},[y,k]),(0,n.useEffect)(()=>{let t=e.current;t&&(v?(t.src=v.url,t.load(),b(0),h(0),l&&t.play().catch(()=>u(!1))):(t.removeAttribute("src"),t.load(),b(0),h(0),u(!1)))},[null==v?void 0:v.url]),(0,n.useEffect)(()=>{let t=e.current;if(!t)return;let a=()=>h(t.duration||0),r=()=>b(t.currentTime||0),n=()=>u(!0),i=()=>u(!1),o=()=>{t.currentTime=0,t.pause()};return t.addEventListener("loadedmetadata",a),t.addEventListener("timeupdate",r),t.addEventListener("play",n),t.addEventListener("pause",i),t.addEventListener("ended",o),()=>{t.removeEventListener("loadedmetadata",a),t.removeEventListener("timeupdate",r),t.removeEventListener("play",n),t.removeEventListener("pause",i),t.removeEventListener("ended",o)}},[]),(0,n.useEffect)(()=>()=>{a.forEach(e=>URL.revokeObjectURL(e.url))},[a]);let I=async e=>{e&&0!==e.length&&(a.forEach(e=>URL.revokeObjectURL(e.url)),i(await c(e)),s(0),u(!1))};return w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{"aria-label":"Show audio player",onClick:()=>g(!1),className:"fixed bottom-3 right-3 z-50 rounded-full bg-blue-600 text-white shadow-lg px-4 py-3 active:scale-95",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 0.25rem)"},children:"Player"}),(0,r.jsx)("input",{ref:t,type:"file",accept:"audio/*",multiple:!0,className:"hidden",onChange:e=>I(e.target.files)}),(0,r.jsx)("audio",{ref:e,preload:"metadata"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("footer",{className:"fixed inset-x-0 bottom-0 z-50 border-t border-neutral-800 bg-neutral-900 text-white shadow-lg",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},role:"region","aria-label":"Audio player",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2",children:[(0,r.jsx)("button",{onClick:()=>g(!0),"aria-label":"Hide audio player",className:"rounded-md border border-neutral-700 bg-neutral-800 px-2 py-1 text-xs hover:bg-neutral-700",children:"Hide"}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.click()},"aria-label":"Select audio files",className:"rounded-md bg-blue-600 px-3 py-2 text-sm font-medium hover:bg-blue-500 active:scale-95",children:"Choose files"}),(0,r.jsx)("button",{onClick:()=>{a.length&&s(e=>(e-1+a.length)%a.length)},"aria-label":"Previous track",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:0===a.length,children:"Prev"}),(0,r.jsx)("button",{onClick:()=>{let t=e.current;t&&(t.currentTime=Math.max(0,t.currentTime-30))},"aria-label":"Seek backward 30 seconds",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:!v,children:"-30s"}),(0,r.jsx)("button",{onClick:()=>{let t=e.current;t&&v&&(t.paused?t.play().catch(()=>u(!1)):t.pause())},"aria-label":l?"Pause":"Play",className:"rounded-md bg-green-600 px-3 py-2 font-medium hover:bg-green-500 active:scale-95 disabled:opacity-60",disabled:!v,children:l?"Pause":"Play"}),(0,r.jsx)("button",{onClick:()=>{let t=e.current;if(!t)return;let a=Number.isFinite(t.duration)?t.duration:t.currentTime+30;t.currentTime=Math.min(a,t.currentTime+30)},"aria-label":"Seek forward 30 seconds",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:!v,children:"+30s"}),(0,r.jsx)("button",{onClick:()=>{a.length&&s(e=>(e+1)%a.length)},"aria-label":"Next track",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:0===a.length,children:"Next"}),(0,r.jsx)("div",{className:"flex items-center gap-2 flex-1 min-w-[160px]",children:(0,r.jsx)("input",{type:"range",min:0,max:Number.isFinite(p)&&p>0?p:0,step:.01,value:Number.isFinite(f)?f:0,onChange:t=>{let a=e.current;if(!a)return;let r=Number(t.target.value);a.currentTime=Number.isFinite(r)?r:0},"aria-label":"Seek position",className:"w-full",disabled:!v||!Number.isFinite(p)||p<=0})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-[150px]",children:[(0,r.jsx)("button",{onClick:()=>S(e=>!e),"aria-label":k?"Unmute":"Mute",className:"rounded-md bg-neutral-800 px-2 py-2 hover:bg-neutral-700 active:scale-95",children:k?"Unmute":"Mute"}),(0,r.jsx)("input",{type:"range",min:0,max:1,step:.01,value:k?0:y,onChange:e=>{let t=Number(e.target.value);x(t),k&&t>0&&S(!1)},"aria-label":"Volume",className:"w-24"})]}),(0,r.jsxs)("div",{className:"text-xs tabular-nums min-w-[120px] text-right",children:[m(f)," / ",m(p)]}),(0,r.jsx)("div",{className:"truncate max-w-[28ch] text-xs text-neutral-300",children:v?"".concat(o+1,"/").concat(a.length," \xb7 ").concat(v.name):"No file selected"})]})}),(0,r.jsx)("input",{ref:t,type:"file",accept:"audio/*",multiple:!0,className:"hidden",onChange:e=>I(e.target.files)}),(0,r.jsx)("audio",{ref:e,preload:"metadata"})]})}},1228:function(e,t,a){"use strict";a.d(t,{default:function(){return o}});var r=a(2265),n=a(8902),i=a(1550);function o(){return(0,r.useEffect)(()=>{(async()=>{await (0,n.Cq)(),await (0,n.oj)((0,i.Gs)())})().catch(e=>{console.error("Bootstrap error:",e)})},[]),null}},3313:function(e,t,a){"use strict";a.d(t,{default:function(){return l}});var r=a(7437),n=a(7138),i=a(1169);let o=[{href:"/",label:"Inicio"},{href:"/workout",label:"Entrenar"},{href:"/capsule",label:"Orgullo Saiyajin"},{href:"/progress",label:"Progreso"},{href:"/dojo",label:"Dojo"},{href:"/settings",label:"Ajustes"}];function s(e,t){return"/"===t?"/"===e:e.startsWith(t)}function l(){let e=(0,i.usePathname)();return(0,r.jsxs)("header",{className:"sticky top-0 z-50 border-b border-white/10 bg-[#0b0f1a]/70 backdrop-blur",children:[(0,r.jsxs)("div",{className:"mx-auto flex max-w-3xl items-center justify-between px-4 py-3",children:[(0,r.jsxs)(n.default,{href:"/",className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/10 shadow-soft",children:"\uD83D\uDC22"}),(0,r.jsxs)("div",{className:"leading-tight",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Turtle Ki"}),(0,r.jsx)("div",{className:"text-[11px] text-white/60",children:"Escuela de la Tortuga"})]})]}),(0,r.jsx)("nav",{className:"hidden gap-1 sm:flex",children:o.map(t=>{let a=s(e,t.href);return(0,r.jsx)(n.default,{href:t.href,className:["rounded-xl px-3 py-2 text-sm transition",a?"bg-white/12 text-white":"text-white/70 hover:bg-white/10 hover:text-white"].join(" "),children:t.label},t.href)})})]}),(0,r.jsx)("div",{className:"sm:hidden",children:(0,r.jsx)("div",{className:"fixed bottom-3 left-0 right-0 z-50",children:(0,r.jsx)("div",{className:"mx-auto flex max-w-3xl justify-between gap-1 px-3",children:(0,r.jsx)("div",{className:"flex w-full justify-between rounded-2xl border border-white/10 bg-[#0b0f1a]/70 p-1 backdrop-blur shadow-soft",children:o.map(t=>{let a=s(e,t.href);return(0,r.jsx)(n.default,{href:t.href,className:["flex-1 rounded-xl px-2 py-2 text-center text-xs transition",a?"bg-white/12 text-white":"text-white/70 hover:bg-white/10 hover:text-white"].join(" "),children:t.label},t.href)})})})})})]})}},1550:function(e,t,a){"use strict";function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}function n(e,t){return e===function(e,t){let a=function(e){let[t,a,r]=e.split("-").map(e=>Number(e));return new Date(t,(null!=a?a:1)-1,null!=r?r:1)}(e);return a.setDate(a.getDate()+-1),r(a)}(t,0)}a.d(t,{Gs:function(){return r},tn:function(){return n}})},9608:function(e,t,a){"use strict";a.d(t,{C6:function(){return u},Sh:function(){return s},db:function(){return o},j3:function(){return c},wv:function(){return l}});var r=a(4635),n=a(1550);class i extends r.ZP{constructor(){super("turtleKiDB"),this.version(1).stores({player:"id",settings:"id",actions:"++id, dateISO, type, createdAtISO",quests:"++id, dateISO, questId, completedAtISO",workouts:"++id, dateISO, templateId, completedAtISO"})}}let o=new i;async function s(){let[e,t]=await Promise.all([o.player.get("player"),o.settings.get("settings")]),a=new Date().toISOString(),r=(0,n.Gs)();e||await o.player.put({id:"player",kiTotal:0,kiToday:0,streak:0,lastDailyResetISO:r,lastTrainingISO:void 0,createdAtISO:a,updatedAtISO:a}),t||await o.settings.put({id:"settings",dailyKiCap:50,difficulty:"normal",reduceMotion:!1})}async function l(){await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()])}),await s()}async function u(){let[e,t,a,r,n]=await Promise.all([o.player.get("player"),o.settings.get("settings"),o.actions.toArray(),o.quests.toArray(),o.workouts.toArray()]);return{exportedAtISO:new Date().toISOString(),player:e,settings:t,actions:a,quests:r,workouts:n}}async function c(e){if(!e||"object"!=typeof e)throw Error("Payload inv\xe1lido");await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()]),e.player&&await o.player.put(e.player),e.settings&&await o.settings.put(e.settings),Array.isArray(e.actions)&&e.actions.length&&await o.actions.bulkAdd(e.actions),Array.isArray(e.quests)&&e.quests.length&&await o.quests.bulkAdd(e.quests),Array.isArray(e.workouts)&&e.workouts.length&&await o.workouts.bulkAdd(e.workouts)}),await s()}},4002:function(e,t,a){"use strict";a.d(t,{P_:function(){return i},cU:function(){return r},wc:function(){return n}});let r={workout_quick:10,workout_full:20,capsule_30:20,capsule_60:40,walk:5,mobility:5,sleep:5,food:5,streak_bonus:25,manual_adjust:0};function n(e){return"easy"===e?.85:"hard"===e?1.15:1}function i(e){return"streak_bonus"!==e}},8902:function(e,t,a){"use strict";a.d(t,{Bw:function(){return b},Cq:function(){return o},Hz:function(){return h},J:function(){return d},XI:function(){return m},lf:function(){return p},nQ:function(){return f},oj:function(){return u}});var r=a(9608),n=a(4002),i=a(1550);async function o(){await r.db.open(),await (0,r.Sh)()}async function s(){let e=await r.db.player.get("player");if(!e)throw Error("Player no inicializado");return e}async function l(){let e=await r.db.settings.get("settings");if(!e)throw Error("Settings no inicializado");return e}async function u(e){await r.db.transaction("rw",r.db.player,async()=>{let t=await s();if(t.lastDailyResetISO!==e){let a=new Date().toISOString();await r.db.player.put({...t,kiToday:0,lastDailyResetISO:e,updatedAtISO:a})}})}async function c(e,t){return await r.db.actions.where({dateISO:e,type:t}).count()>0}async function d(e){var t;let{todayISO:a,type:i,note:o}=e,u=null!==(t=n.cU[i])&&void 0!==t?t:0;return await c(a,i)?{kiAdded:0,capped:!1,message:"Ya reclamaste esta acci\xf3n hoy."}:await r.db.transaction("rw",r.db.player,r.db.settings,r.db.actions,async()=>{let[e,t]=await Promise.all([s(),l()]),c=new Date().toISOString(),d=u,m=!1;if((0,n.P_)(i)){let a=Math.max(0,t.dailyKiCap-e.kiToday);a<=0?(d=0,m=!0):d>a&&(d=a,m=!0)}let f={...e,kiTotal:e.kiTotal+d,kiToday:e.kiToday+d,updatedAtISO:c};await r.db.player.put(f);let b={dateISO:a,type:i,kiDelta:d,createdAtISO:c,note:o};await r.db.actions.add(b);let p=d>0?"+".concat(d," KI (").concat(i.replaceAll("_"," "),")"):m?"Cap diario alcanzado. Hoy ya hiciste suficiente \uD83D\uDC22":"Acci\xf3n registrada.";return{kiAdded:d,capped:m,message:p}})}async function m(e){let{todayISO:t,templateId:a,mode:o,durationSec:u}=e,d="full"===o?"workout_full":"workout_quick";return await c(t,d)?(await r.db.workouts.add({dateISO:t,templateId:a,completedAtISO:new Date().toISOString(),durationSec:u,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI del workout ya fue reclamado hoy."}):await r.db.transaction("rw",r.db.player,r.db.settings,r.db.actions,r.db.workouts,async()=>{var e,c;let[m,f]=await Promise.all([s(),l()]),b=new Date().toISOString(),p=null!==(e=n.cU[d])&&void 0!==e?e:0,h=!1,w=Math.max(0,f.dailyKiCap-m.kiToday);w<=0?(p=0,h=!0):p>w&&(p=w,h=!0);let g=m.streak,y=0;m.lastTrainingISO!==t&&(g=m.lastTrainingISO&&(0,i.tn)(m.lastTrainingISO,t)?m.streak+1:1)>0&&g%7==0&&(y=null!==(c=n.cU.streak_bonus)&&void 0!==c?c:0);let x={...m,kiTotal:m.kiTotal+p+y,kiToday:m.kiToday+p+y,streak:g,lastTrainingISO:t,updatedAtISO:b};await r.db.player.put(x),await r.db.actions.add({dateISO:t,type:d,kiDelta:p,createdAtISO:b,note:a}),y>0&&await r.db.actions.add({dateISO:t,type:"streak_bonus",kiDelta:y,createdAtISO:b,note:"streak=".concat(g)}),await r.db.workouts.add({dateISO:t,templateId:a,completedAtISO:b,durationSec:u,mode:o});let k=p>0?"Entrenamiento completado: +".concat(p," KI").concat(y?" +".concat(y," KI bonus"):""," ✅"):h?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:p,streak:g,bonusKi:y,message:k}})}async function f(e){let{todayISO:t,templateId:a,variant:o,durationSec:u}=e;return await c(t,o)?(await r.db.workouts.add({dateISO:t,templateId:a,completedAtISO:new Date().toISOString(),durationSec:u,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI ya fue reclamado hoy."}):await r.db.transaction("rw",r.db.player,r.db.settings,r.db.actions,r.db.workouts,async()=>{var e,c;let[d,m]=await Promise.all([s(),l()]),f=new Date().toISOString(),b=null!==(e=n.cU[o])&&void 0!==e?e:0,p=!1,h=Math.max(0,m.dailyKiCap-d.kiToday);h<=0?(b=0,p=!0):b>h&&(b=h,p=!0);let w=d.streak,g=0;d.lastTrainingISO!==t&&(w=d.lastTrainingISO&&(0,i.tn)(d.lastTrainingISO,t)?d.streak+1:1)>0&&w%7==0&&(g=null!==(c=n.cU.streak_bonus)&&void 0!==c?c:0);let y={...d,kiTotal:d.kiTotal+b+g,kiToday:d.kiToday+b+g,streak:w,lastTrainingISO:t,updatedAtISO:f};await r.db.player.put(y),await r.db.actions.add({dateISO:t,type:o,kiDelta:b,createdAtISO:f,note:a}),g>0&&await r.db.actions.add({dateISO:t,type:"streak_bonus",kiDelta:g,createdAtISO:f,note:"streak=".concat(w)}),await r.db.workouts.add({dateISO:t,templateId:a,completedAtISO:f,durationSec:u,mode:o});let x=b>0?"Orgullo Saiyajin completado: +".concat(b," KI").concat(g?" +".concat(g," KI bonus"):""," ✅"):p?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:b,streak:w,bonusKi:g,message:x}})}async function b(e){await r.db.transaction("rw",r.db.settings,async()=>{let t=await l();await r.db.settings.put({...t,dailyKiCap:Math.max(10,Math.min(200,Math.round(e)))})})}async function p(e){await r.db.transaction("rw",r.db.settings,async()=>{let t=await l();await r.db.settings.put({...t,difficulty:e})})}async function h(e){await r.db.transaction("rw",r.db.settings,async()=>{let t=await l();await r.db.settings.put({...t,reduceMotion:e})})}},3054:function(){}},function(e){e.O(0,[141,635,138,971,23,744],function(){return e(e.s=1558)}),_N_E=e.O()}]);