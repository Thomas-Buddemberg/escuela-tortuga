(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1558:function(e,t,a){Promise.resolve().then(a.bind(a,912)),Promise.resolve().then(a.bind(a,1481)),Promise.resolve().then(a.t.bind(a,3054,23)),Promise.resolve().then(a.bind(a,8043)),Promise.resolve().then(a.bind(a,1228)),Promise.resolve().then(a.bind(a,1413))},6463:function(e,t,a){"use strict";var n=a(1169);a.o(n,"redirect")&&a.d(t,{redirect:function(){return n.redirect}}),a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}})},551:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let n=a(9920);a(7437),a(2265);let r=n._(a(148));function i(e,t){var a;let n={loading:e=>{let{error:t,isLoading:a,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let i={...n,...t};return(0,r.default)({...i,modules:null==(a=i.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let n=a(5592);function r(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return a}},148:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let n=a(7437),r=a(2265),i=a(912),o=a(1481);function s(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},u=function(e){let t={...l,...e},a=(0,r.lazy)(()=>t.loader().then(s)),u=t.loading;function d(e){let s=u?(0,n.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(o.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(r.Suspense,{fallback:s,children:l})}return d.displayName="LoadableComponent",d}},1481:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return i}});let n=a(7437),r=a(8512);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,r.getExpectedRequestStore)("next/dynamic css"),i=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));i.push(...t)}}return 0===i.length?null:(0,n.jsx)(n.Fragment,{children:i.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},8043:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var n=a(7437),r=a(2265);let i="tracks",o="meta",s="order";function l(){return new Promise((e,t)=>{let a=indexedDB.open("escuelaAudio",1);a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(o)||e.createObjectStore(o,{keyPath:"key"})},a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}function u(e,t,a){return e.transaction(t,a)}async function d(e){let t=await l(),a=[];return await new Promise((n,r)=>{let l=u(t,[i,o],"readwrite");l.objectStore(i).clear(),l.objectStore(o).put({key:s,order:[]});let d=l.objectStore(i);Array.from(e).forEach(e=>{let t={name:e.name,blob:e,createdAtISO:new Date().toISOString()},n=d.add(t);n.onsuccess=()=>{let e=n.result;a.push(e)}}),l.oncomplete=()=>n(),l.onabort=()=>r(l.error),l.onerror=()=>r(l.error)}),await new Promise(async(e,t)=>{let n=u(await l(),[o],"readwrite");n.objectStore(o).put({key:s,order:a}),n.oncomplete=()=>e(),n.onabort=()=>t(n.error),n.onerror=()=>t(n.error)}),(await c()).map(e=>({id:e.id,name:e.name,url:URL.createObjectURL(e.blob)}))}async function c(){let e=await l(),t=await new Promise(t=>{let a=u(e,[o],"readonly").objectStore(o).get(s);a.onsuccess=()=>{var e;return t(null===(e=a.result)||void 0===e?void 0:e.order)},a.onerror=()=>t(void 0)}),a=u(e,[i],"readonly").objectStore(i),n=e=>new Promise(t=>{let n=a.get(e);n.onsuccess=()=>t(n.result),n.onerror=()=>t(void 0)});if(t&&t.length){let e=[];for(let a of t){let t=await n(a);t&&e.push(t)}return e}return new Promise(e=>{let t=[],n=a.openCursor();n.onsuccess=()=>{let a=n.result;a?(t.push(a.value),a.continue()):e(t)},n.onerror=()=>e(t)})}function f(e){if(!Number.isFinite(e)||e<0)return"0:00";let t=Math.floor(e%60).toString().padStart(2,"0");return"".concat(Math.floor(e/60),":").concat(t)}function m(){let e=(0,r.useRef)(null),t=(0,r.useRef)(null),[a,i]=(0,r.useState)([]),[o,s]=(0,r.useState)(0),[l,u]=(0,r.useState)(!1),[m,b]=(0,r.useState)(0),[p,h]=(0,r.useState)(0),[y,w]=(0,r.useState)(!1),[g,x]=(0,r.useState)(1),[k,S]=(0,r.useState)(!1),v=(0,r.useMemo)(()=>a[o],[a,o]);(0,r.useEffect)(()=>{try{let e=localStorage.getItem("audio:hidden");"1"===e&&w(!0);let t=localStorage.getItem("audio:volume");t&&x(Math.max(0,Math.min(1,Number(t))));let a=localStorage.getItem("audio:muted");a&&S("1"===a)}catch(e){}},[]),(0,r.useEffect)(()=>{try{localStorage.setItem("audio:hidden",y?"1":"0")}catch(e){}},[y]),(0,r.useEffect)(()=>{try{localStorage.setItem("audio:volume",String(g))}catch(e){}},[g]),(0,r.useEffect)(()=>{try{localStorage.setItem("audio:muted",k?"1":"0")}catch(e){}},[k]),(0,r.useEffect)(()=>{(async()=>{try{let e=await c();if(e&&e.length){let t=e.map(e=>({id:e.id,name:e.name,url:URL.createObjectURL(e.blob)}));i(t),s(0)}}catch(e){}})()},[]),(0,r.useEffect)(()=>{let t=e.current;t&&(t.volume=Number.isFinite(g)?Math.max(0,Math.min(1,g)):1,t.muted=!!k)},[g,k]),(0,r.useEffect)(()=>{let t=e.current;t&&(v?(t.src=v.url,t.load(),b(0),h(0),l&&t.play().catch(()=>u(!1))):(t.removeAttribute("src"),t.load(),b(0),h(0),u(!1)))},[null==v?void 0:v.url]),(0,r.useEffect)(()=>{let t=e.current;if(!t)return;let a=()=>h(t.duration||0),n=()=>b(t.currentTime||0),r=()=>u(!0),i=()=>u(!1),o=()=>{t.currentTime=0,t.pause()};return t.addEventListener("loadedmetadata",a),t.addEventListener("timeupdate",n),t.addEventListener("play",r),t.addEventListener("pause",i),t.addEventListener("ended",o),()=>{t.removeEventListener("loadedmetadata",a),t.removeEventListener("timeupdate",n),t.removeEventListener("play",r),t.removeEventListener("pause",i),t.removeEventListener("ended",o)}},[]),(0,r.useEffect)(()=>()=>{a.forEach(e=>URL.revokeObjectURL(e.url))},[a]);let j=async e=>{e&&0!==e.length&&(a.forEach(e=>URL.revokeObjectURL(e.url)),i(await d(e)),s(0),u(!1))};return y?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{"aria-label":"Show audio player",onClick:()=>w(!1),className:"fixed bottom-3 right-3 z-50 rounded-full bg-blue-600 text-white shadow-lg px-4 py-3 active:scale-95",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 0.25rem)"},children:"Player"}),(0,n.jsx)("input",{ref:t,type:"file",accept:"audio/*",multiple:!0,className:"hidden",onChange:e=>j(e.target.files)}),(0,n.jsx)("audio",{ref:e,preload:"metadata"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("footer",{className:"fixed inset-x-0 bottom-0 z-50 border-t border-neutral-800 bg-neutral-900 text-white shadow-lg",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},role:"region","aria-label":"Audio player",children:(0,n.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2",children:[(0,n.jsx)("button",{onClick:()=>w(!0),"aria-label":"Hide audio player",className:"rounded-md border border-neutral-700 bg-neutral-800 px-2 py-1 text-xs hover:bg-neutral-700",children:"Hide"}),(0,n.jsx)("button",{onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.click()},"aria-label":"Select audio files",className:"rounded-md bg-blue-600 px-3 py-2 text-sm font-medium hover:bg-blue-500 active:scale-95",children:"Choose files"}),(0,n.jsx)("button",{onClick:()=>{a.length&&s(e=>(e-1+a.length)%a.length)},"aria-label":"Previous track",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:0===a.length,children:"Prev"}),(0,n.jsx)("button",{onClick:()=>{let t=e.current;t&&(t.currentTime=Math.max(0,t.currentTime-30))},"aria-label":"Seek backward 30 seconds",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:!v,children:"-30s"}),(0,n.jsx)("button",{onClick:()=>{let t=e.current;t&&v&&(t.paused?t.play().catch(()=>u(!1)):t.pause())},"aria-label":l?"Pause":"Play",className:"rounded-md bg-green-600 px-3 py-2 font-medium hover:bg-green-500 active:scale-95 disabled:opacity-60",disabled:!v,children:l?"Pause":"Play"}),(0,n.jsx)("button",{onClick:()=>{let t=e.current;if(!t)return;let a=Number.isFinite(t.duration)?t.duration:t.currentTime+30;t.currentTime=Math.min(a,t.currentTime+30)},"aria-label":"Seek forward 30 seconds",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:!v,children:"+30s"}),(0,n.jsx)("button",{onClick:()=>{a.length&&s(e=>(e+1)%a.length)},"aria-label":"Next track",className:"rounded-md bg-neutral-800 px-3 py-2 hover:bg-neutral-700 active:scale-95",disabled:0===a.length,children:"Next"}),(0,n.jsx)("div",{className:"flex items-center gap-2 flex-1 min-w-[160px]",children:(0,n.jsx)("input",{type:"range",min:0,max:Number.isFinite(p)&&p>0?p:0,step:.01,value:Number.isFinite(m)?m:0,onChange:t=>{let a=e.current;if(!a)return;let n=Number(t.target.value);a.currentTime=Number.isFinite(n)?n:0},"aria-label":"Seek position",className:"w-full",disabled:!v||!Number.isFinite(p)||p<=0})}),(0,n.jsxs)("div",{className:"flex items-center gap-2 min-w-[150px]",children:[(0,n.jsx)("button",{onClick:()=>S(e=>!e),"aria-label":k?"Unmute":"Mute",className:"rounded-md bg-neutral-800 px-2 py-2 hover:bg-neutral-700 active:scale-95",children:k?"Unmute":"Mute"}),(0,n.jsx)("input",{type:"range",min:0,max:1,step:.01,value:k?0:g,onChange:e=>{let t=Number(e.target.value);x(t),k&&t>0&&S(!1)},"aria-label":"Volume",className:"w-24"})]}),(0,n.jsxs)("div",{className:"text-xs tabular-nums min-w-[120px] text-right",children:[f(m)," / ",f(p)]}),(0,n.jsx)("div",{className:"truncate max-w-[28ch] text-xs text-neutral-300",children:v?"".concat(o+1,"/").concat(a.length," \xb7 ").concat(v.name):"No file selected"})]})}),(0,n.jsx)("input",{ref:t,type:"file",accept:"audio/*",multiple:!0,className:"hidden",onChange:e=>j(e.target.files)}),(0,n.jsx)("audio",{ref:e,preload:"metadata"})]})}},1228:function(e,t,a){"use strict";a.d(t,{default:function(){return o}});var n=a(2265),r=a(8902),i=a(1550);function o(){return(0,n.useEffect)(()=>{(async()=>{await (0,r.Cq)(),await (0,r.oj)((0,i.Gs)())})().catch(e=>{console.error("Bootstrap error:",e)})},[]),null}},1413:function(e,t,a){"use strict";a.d(t,{default:function(){return d}});var n=a(7437),r=a(7138),i=a(6463),o=a(551);let s=a.n(o)()(()=>a.e(602).then(a.bind(a,5602)),{loadableGenerated:{webpack:()=>[5602]},ssr:!1}),l=[{href:"/",label:"Inicio"},{href:"/workout",label:"Entrenar"},{href:"/orgullo",label:"Orgullo Saiyajin"},{href:"/progreso",label:"Progreso"},{href:"/dojo",label:"Dojo"},{href:"/settings",label:"Ajustes"}];function u(e,t){return"/"===t?"/"===e:e.startsWith(t)}function d(){let e=(0,i.usePathname)();return(0,n.jsxs)("header",{className:"sticky top-0 z-50 border-b border-white/10 bg-[#0b0f1a]/70 backdrop-blur",children:[(0,n.jsxs)("div",{className:"mx-auto flex max-w-3xl items-center justify-between px-4 py-3",children:[(0,n.jsxs)(r.default,{href:"/",className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/10 shadow-soft",children:"\uD83D\uDC22"}),(0,n.jsxs)("div",{className:"leading-tight",children:[(0,n.jsx)("div",{className:"text-sm font-semibold",children:"Turtle Ki"}),(0,n.jsx)("div",{className:"text-[11px] text-white/60",children:"Escuela de la Tortuga"})]})]}),(0,n.jsxs)("nav",{className:"hidden items-center gap-2 sm:flex",children:[l.map(t=>{let a=u(e,t.href);return(0,n.jsx)(r.default,{href:t.href,className:["rounded-xl px-3 py-2 text-sm transition",a?"bg-white/12 text-white":"text-white/70 hover:bg-white/10 hover:text-white"].join(" "),children:t.label},t.href)}),(0,n.jsx)(s,{className:"hidden sm:inline-flex"})]})]}),(0,n.jsxs)("div",{className:"sm:hidden",children:[(0,n.jsx)("div",{className:"fixed bottom-16 left-0 right-0 z-50 flex justify-center px-3",children:(0,n.jsx)(s,{className:"inline-flex sm:hidden"})}),(0,n.jsx)("div",{className:"fixed bottom-3 left-0 right-0 z-40",children:(0,n.jsx)("div",{className:"mx-auto flex max-w-3xl justify-between gap-1 px-3",children:(0,n.jsx)("div",{className:"flex w-full justify-between rounded-2xl border border-white/10 bg-[#0b0f1a]/70 p-1 backdrop-blur shadow-soft",children:l.map(t=>{let a=u(e,t.href);return(0,n.jsx)(r.default,{href:t.href,className:["flex-1 rounded-xl px-2 py-2 text-center text-xs transition",a?"bg-white/12 text-white":"text-white/70 hover:bg-white/10 hover:text-white"].join(" "),children:t.label},t.href)})})})})]})]})}},1550:function(e,t,a){"use strict";function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)}function r(e){let[t,a,n]=e.split("-").map(e=>Number(e));return new Date(t,(null!=a?a:1)-1,null!=n?n:1)}function i(e,t){let a=r(e);return a.setDate(a.getDate()+t),n(a)}function o(e,t){return e===i(t,-1)}a.d(t,{$I:function(){return r},Gs:function(){return n},NH:function(){return i},tn:function(){return o}})},9608:function(e,t,a){"use strict";a.d(t,{C6:function(){return u},Sh:function(){return s},db:function(){return o},j3:function(){return d},wv:function(){return l}});var n=a(4635),r=a(1550);class i extends n.ZP{constructor(){super("turtleKiDB"),this.version(1).stores({player:"id",settings:"id",actions:"++id, dateISO, type, createdAtISO",quests:"++id, dateISO, questId, completedAtISO",workouts:"++id, dateISO, templateId, completedAtISO"})}}let o=new i;async function s(){let[e,t]=await Promise.all([o.player.get("player"),o.settings.get("settings")]),a=new Date().toISOString(),n=(0,r.Gs)();e||await o.player.put({id:"player",kiTotal:0,kiToday:0,streak:0,lastDailyResetISO:n,lastTrainingISO:void 0,createdAtISO:a,updatedAtISO:a}),t||await o.settings.put({id:"settings",dailyKiCap:50,difficulty:"normal",reduceMotion:!1})}async function l(){await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()])}),await s()}async function u(){let[e,t,a,n,r]=await Promise.all([o.player.get("player"),o.settings.get("settings"),o.actions.toArray(),o.quests.toArray(),o.workouts.toArray()]);return{exportedAtISO:new Date().toISOString(),player:e,settings:t,actions:a,quests:n,workouts:r}}async function d(e){if(!e||"object"!=typeof e)throw Error("Payload inv\xe1lido");await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()]),e.player&&await o.player.put(e.player),e.settings&&await o.settings.put(e.settings),Array.isArray(e.actions)&&e.actions.length&&await o.actions.bulkAdd(e.actions),Array.isArray(e.quests)&&e.quests.length&&await o.quests.bulkAdd(e.quests),Array.isArray(e.workouts)&&e.workouts.length&&await o.workouts.bulkAdd(e.workouts)}),await s()}},4002:function(e,t,a){"use strict";a.d(t,{P_:function(){return i},cU:function(){return n},wc:function(){return r}});let n={workout_quick:10,workout_full:20,capsule_30:20,capsule_60:40,walk:5,mobility:5,sleep:5,food:5,streak_bonus:25,manual_adjust:0};function r(e){return"easy"===e?.85:"hard"===e?1.15:1}function i(e){return"streak_bonus"!==e}},8902:function(e,t,a){"use strict";a.d(t,{Bw:function(){return b},Cq:function(){return o},Hz:function(){return h},J:function(){return c},XI:function(){return f},lf:function(){return p},nQ:function(){return m},oj:function(){return u}});var n=a(9608),r=a(4002),i=a(1550);async function o(){await n.db.open(),await (0,n.Sh)()}async function s(){let e=await n.db.player.get("player");if(!e)throw Error("Player no inicializado");return e}async function l(){let e=await n.db.settings.get("settings");if(!e)throw Error("Settings no inicializado");return e}async function u(e){await n.db.transaction("rw",n.db.player,async()=>{let t=await s();if(t.lastDailyResetISO!==e){let a=new Date().toISOString();await n.db.player.put({...t,kiToday:0,lastDailyResetISO:e,updatedAtISO:a})}})}async function d(e,t){return await n.db.actions.where({dateISO:e,type:t}).count()>0}async function c(e){var t;let{todayISO:a,type:i,note:o}=e,u=null!==(t=r.cU[i])&&void 0!==t?t:0;return await d(a,i)?{kiAdded:0,capped:!1,message:"Ya reclamaste esta acci\xf3n hoy."}:await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,async()=>{let[e,t]=await Promise.all([s(),l()]),d=new Date().toISOString(),c=u,f=!1;if((0,r.P_)(i)){let a=Math.max(0,t.dailyKiCap-e.kiToday);a<=0?(c=0,f=!0):c>a&&(c=a,f=!0)}let m={...e,kiTotal:e.kiTotal+c,kiToday:e.kiToday+c,updatedAtISO:d};await n.db.player.put(m);let b={dateISO:a,type:i,kiDelta:c,createdAtISO:d,note:o};await n.db.actions.add(b);let p=c>0?"+".concat(c," KI (").concat(i.replaceAll("_"," "),")"):f?"Cap diario alcanzado. Hoy ya hiciste suficiente \uD83D\uDC22":"Acci\xf3n registrada.";return{kiAdded:c,capped:f,message:p}})}async function f(e){let{todayISO:t,templateId:a,mode:o,durationSec:u}=e,c="full"===o?"workout_full":"workout_quick";return await d(t,c)?(await n.db.workouts.add({dateISO:t,templateId:a,completedAtISO:new Date().toISOString(),durationSec:u,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI del workout ya fue reclamado hoy."}):await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,n.db.workouts,async()=>{var e,d;let[f,m]=await Promise.all([s(),l()]),b=new Date().toISOString(),p=null!==(e=r.cU[c])&&void 0!==e?e:0,h=!1,y=Math.max(0,m.dailyKiCap-f.kiToday);y<=0?(p=0,h=!0):p>y&&(p=y,h=!0);let w=f.streak,g=0;f.lastTrainingISO!==t&&(w=f.lastTrainingISO&&(0,i.tn)(f.lastTrainingISO,t)?f.streak+1:1)>0&&w%7==0&&(g=null!==(d=r.cU.streak_bonus)&&void 0!==d?d:0);let x={...f,kiTotal:f.kiTotal+p+g,kiToday:f.kiToday+p+g,streak:w,lastTrainingISO:t,updatedAtISO:b};await n.db.player.put(x),await n.db.actions.add({dateISO:t,type:c,kiDelta:p,createdAtISO:b,note:a}),g>0&&await n.db.actions.add({dateISO:t,type:"streak_bonus",kiDelta:g,createdAtISO:b,note:"streak=".concat(w)}),await n.db.workouts.add({dateISO:t,templateId:a,completedAtISO:b,durationSec:u,mode:o});let k=p>0?"Entrenamiento completado: +".concat(p," KI").concat(g?" +".concat(g," KI bonus"):""," ✅"):h?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:p,streak:w,bonusKi:g,message:k}})}async function m(e){let{todayISO:t,templateId:a,variant:o,durationSec:u}=e;return await d(t,o)?(await n.db.workouts.add({dateISO:t,templateId:a,completedAtISO:new Date().toISOString(),durationSec:u,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI ya fue reclamado hoy."}):await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,n.db.workouts,async()=>{var e,d;let[c,f]=await Promise.all([s(),l()]),m=new Date().toISOString(),b=null!==(e=r.cU[o])&&void 0!==e?e:0,p=!1,h=Math.max(0,f.dailyKiCap-c.kiToday);h<=0?(b=0,p=!0):b>h&&(b=h,p=!0);let y=c.streak,w=0;c.lastTrainingISO!==t&&(y=c.lastTrainingISO&&(0,i.tn)(c.lastTrainingISO,t)?c.streak+1:1)>0&&y%7==0&&(w=null!==(d=r.cU.streak_bonus)&&void 0!==d?d:0);let g={...c,kiTotal:c.kiTotal+b+w,kiToday:c.kiToday+b+w,streak:y,lastTrainingISO:t,updatedAtISO:m};await n.db.player.put(g),await n.db.actions.add({dateISO:t,type:o,kiDelta:b,createdAtISO:m,note:a}),w>0&&await n.db.actions.add({dateISO:t,type:"streak_bonus",kiDelta:w,createdAtISO:m,note:"streak=".concat(y)}),await n.db.workouts.add({dateISO:t,templateId:a,completedAtISO:m,durationSec:u,mode:o});let x=b>0?"Orgullo Saiyajin completado: +".concat(b," KI").concat(w?" +".concat(w," KI bonus"):""," ✅"):p?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:b,streak:y,bonusKi:w,message:x}})}async function b(e){await n.db.transaction("rw",n.db.settings,async()=>{let t=await l();await n.db.settings.put({...t,dailyKiCap:Math.max(10,Math.min(200,Math.round(e)))})})}async function p(e){await n.db.transaction("rw",n.db.settings,async()=>{let t=await l();await n.db.settings.put({...t,difficulty:e})})}async function h(e){await n.db.transaction("rw",n.db.settings,async()=>{let t=await l();await n.db.settings.put({...t,reduceMotion:e})})}},3054:function(){}},function(e){e.O(0,[141,635,138,971,23,744],function(){return e(e.s=1558)}),_N_E=e.O()}]);