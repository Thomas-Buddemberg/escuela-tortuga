"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{2098:function(t,e,a){a.d(e,{Z:function(){return r}});var n=a(7437);function r(t){let{variant:e="primary",className:a="",...r}=t;return(0,n.jsx)("button",{className:["inline-flex items-center justify-center gap-2 rounded-xl px-3 py-2 text-sm font-medium transition disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-white text-black hover:opacity-90",secondary:"bg-white/10 text-white hover:bg-white/15 border border-white/10",ghost:"bg-transparent text-white/80 hover:bg-white/10 hover:text-white",danger:"bg-red-500/20 text-red-200 hover:bg-red-500/25 border border-red-500/25"}[e],a].join(" "),...r})}},1672:function(t,e,a){a.d(e,{Z:function(){return r}});var n=a(7437);function r(t){let{title:e,children:a,right:r}=t;return(0,n.jsxs)("section",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 shadow-soft",children:[e||r?(0,n.jsxs)("header",{className:"mb-3 flex items-start justify-between gap-4",children:[e?(0,n.jsx)("h2",{className:"text-sm font-semibold text-white/90",children:e}):(0,n.jsx)("div",{}),r]}):null,null!=a?a:null]})}},8873:function(t,e,a){a.d(e,{Z:function(){return i}});var n=a(7437),r=a(2265);function i(t){let{message:e,kind:a="info",onClose:i,durationMs:o=2600}=t,[s,u]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let t=setTimeout(()=>{u(!1),i()},o);return()=>clearTimeout(t)},[o,i]),s)?(0,n.jsx)("div",{className:"fixed inset-x-0 bottom-20 z-50 mx-auto max-w-3xl px-4",children:(0,n.jsx)("div",{className:"rounded-2xl border p-3 shadow-soft ".concat("success"===a?"border-emerald-500/25 bg-emerald-500/12 text-emerald-100":"warning"===a?"border-amber-500/25 bg-amber-500/12 text-amber-100":"border-white/10 bg-white/6 text-white/90"),children:(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,n.jsx)("div",{className:"text-sm",children:e}),(0,n.jsx)("button",{className:"rounded-lg px-2 py-1 text-xs text-white/70 hover:bg-white/10",onClick:()=>{u(!1),i()},children:"Cerrar"})]})})}):null}},1550:function(t,e,a){function n(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(e,"-").concat(a,"-").concat(n)}function r(t,e){return t===function(t,e){let a=function(t){let[e,a,n]=t.split("-").map(t=>Number(t));return new Date(e,(null!=a?a:1)-1,null!=n?n:1)}(t);return a.setDate(a.getDate()+-1),n(a)}(e,0)}a.d(e,{Gs:function(){return n},tn:function(){return r}})},9608:function(t,e,a){a.d(e,{C6:function(){return c},Sh:function(){return s},db:function(){return o},j3:function(){return l},wv:function(){return u}});var n=a(4635),r=a(1550);class i extends n.ZP{constructor(){super("turtleKiDB"),this.version(1).stores({player:"id",settings:"id",actions:"++id, dateISO, type, createdAtISO",quests:"++id, dateISO, questId, completedAtISO",workouts:"++id, dateISO, templateId, completedAtISO"})}}let o=new i;async function s(){let[t,e]=await Promise.all([o.player.get("player"),o.settings.get("settings")]),a=new Date().toISOString(),n=(0,r.Gs)();t||await o.player.put({id:"player",kiTotal:0,kiToday:0,streak:0,lastDailyResetISO:n,lastTrainingISO:void 0,createdAtISO:a,updatedAtISO:a}),e||await o.settings.put({id:"settings",dailyKiCap:50,difficulty:"normal",reduceMotion:!1})}async function u(){await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()])}),await s()}async function c(){let[t,e,a,n,r]=await Promise.all([o.player.get("player"),o.settings.get("settings"),o.actions.toArray(),o.quests.toArray(),o.workouts.toArray()]);return{exportedAtISO:new Date().toISOString(),player:t,settings:e,actions:a,quests:n,workouts:r}}async function l(t){if(!t||"object"!=typeof t)throw Error("Payload inv\xe1lido");await o.transaction("rw",[o.player,o.settings,o.actions,o.quests,o.workouts],async()=>{await Promise.all([o.player.clear(),o.settings.clear(),o.actions.clear(),o.quests.clear(),o.workouts.clear()]),t.player&&await o.player.put(t.player),t.settings&&await o.settings.put(t.settings),Array.isArray(t.actions)&&t.actions.length&&await o.actions.bulkAdd(t.actions),Array.isArray(t.quests)&&t.quests.length&&await o.quests.bulkAdd(t.quests),Array.isArray(t.workouts)&&t.workouts.length&&await o.workouts.bulkAdd(t.workouts)}),await s()}},4002:function(t,e,a){a.d(e,{P_:function(){return i},cU:function(){return n},wc:function(){return r}});let n={workout_quick:10,workout_full:20,capsule_30:20,capsule_60:40,walk:5,mobility:5,sleep:5,food:5,streak_bonus:25,manual_adjust:0};function r(t){return"easy"===t?.85:"hard"===t?1.15:1}function i(t){return"streak_bonus"!==t}},8902:function(t,e,a){a.d(e,{Bw:function(){return f},Cq:function(){return o},Hz:function(){return p},J:function(){return d},XI:function(){return w},lf:function(){return b},nQ:function(){return y},oj:function(){return c}});var n=a(9608),r=a(4002),i=a(1550);async function o(){await n.db.open(),await (0,n.Sh)()}async function s(){let t=await n.db.player.get("player");if(!t)throw Error("Player no inicializado");return t}async function u(){let t=await n.db.settings.get("settings");if(!t)throw Error("Settings no inicializado");return t}async function c(t){await n.db.transaction("rw",n.db.player,async()=>{let e=await s();if(e.lastDailyResetISO!==t){let a=new Date().toISOString();await n.db.player.put({...e,kiToday:0,lastDailyResetISO:t,updatedAtISO:a})}})}async function l(t,e){return await n.db.actions.where({dateISO:t,type:e}).count()>0}async function d(t){var e;let{todayISO:a,type:i,note:o}=t,c=null!==(e=r.cU[i])&&void 0!==e?e:0;return await l(a,i)?{kiAdded:0,capped:!1,message:"Ya reclamaste esta acci\xf3n hoy."}:await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,async()=>{let[t,e]=await Promise.all([s(),u()]),l=new Date().toISOString(),d=c,w=!1;if((0,r.P_)(i)){let a=Math.max(0,e.dailyKiCap-t.kiToday);a<=0?(d=0,w=!0):d>a&&(d=a,w=!0)}let y={...t,kiTotal:t.kiTotal+d,kiToday:t.kiToday+d,updatedAtISO:l};await n.db.player.put(y);let f={dateISO:a,type:i,kiDelta:d,createdAtISO:l,note:o};await n.db.actions.add(f);let b=d>0?"+".concat(d," KI (").concat(i.replaceAll("_"," "),")"):w?"Cap diario alcanzado. Hoy ya hiciste suficiente \uD83D\uDC22":"Acci\xf3n registrada.";return{kiAdded:d,capped:w,message:b}})}async function w(t){let{todayISO:e,templateId:a,mode:o,durationSec:c}=t,d="full"===o?"workout_full":"workout_quick";return await l(e,d)?(await n.db.workouts.add({dateISO:e,templateId:a,completedAtISO:new Date().toISOString(),durationSec:c,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI del workout ya fue reclamado hoy."}):await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,n.db.workouts,async()=>{var t,l;let[w,y]=await Promise.all([s(),u()]),f=new Date().toISOString(),b=null!==(t=r.cU[d])&&void 0!==t?t:0,p=!1,g=Math.max(0,y.dailyKiCap-w.kiToday);g<=0?(b=0,p=!0):b>g&&(b=g,p=!0);let k=w.streak,m=0;w.lastTrainingISO!==e&&(k=w.lastTrainingISO&&(0,i.tn)(w.lastTrainingISO,e)?w.streak+1:1)>0&&k%7==0&&(m=null!==(l=r.cU.streak_bonus)&&void 0!==l?l:0);let h={...w,kiTotal:w.kiTotal+b+m,kiToday:w.kiToday+b+m,streak:k,lastTrainingISO:e,updatedAtISO:f};await n.db.player.put(h),await n.db.actions.add({dateISO:e,type:d,kiDelta:b,createdAtISO:f,note:a}),m>0&&await n.db.actions.add({dateISO:e,type:"streak_bonus",kiDelta:m,createdAtISO:f,note:"streak=".concat(k)}),await n.db.workouts.add({dateISO:e,templateId:a,completedAtISO:f,durationSec:c,mode:o});let S=b>0?"Entrenamiento completado: +".concat(b," KI").concat(m?" +".concat(m," KI bonus"):""," ✅"):p?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:b,streak:k,bonusKi:m,message:S}})}async function y(t){let{todayISO:e,templateId:a,variant:o,durationSec:c}=t;return await l(e,o)?(await n.db.workouts.add({dateISO:e,templateId:a,completedAtISO:new Date().toISOString(),durationSec:c,mode:o}),{kiAdded:0,streak:(await s()).streak,bonusKi:0,message:"Workout guardado. El KI ya fue reclamado hoy."}):await n.db.transaction("rw",n.db.player,n.db.settings,n.db.actions,n.db.workouts,async()=>{var t,l;let[d,w]=await Promise.all([s(),u()]),y=new Date().toISOString(),f=null!==(t=r.cU[o])&&void 0!==t?t:0,b=!1,p=Math.max(0,w.dailyKiCap-d.kiToday);p<=0?(f=0,b=!0):f>p&&(f=p,b=!0);let g=d.streak,k=0;d.lastTrainingISO!==e&&(g=d.lastTrainingISO&&(0,i.tn)(d.lastTrainingISO,e)?d.streak+1:1)>0&&g%7==0&&(k=null!==(l=r.cU.streak_bonus)&&void 0!==l?l:0);let m={...d,kiTotal:d.kiTotal+f+k,kiToday:d.kiToday+f+k,streak:g,lastTrainingISO:e,updatedAtISO:y};await n.db.player.put(m),await n.db.actions.add({dateISO:e,type:o,kiDelta:f,createdAtISO:y,note:a}),k>0&&await n.db.actions.add({dateISO:e,type:"streak_bonus",kiDelta:k,createdAtISO:y,note:"streak=".concat(g)}),await n.db.workouts.add({dateISO:e,templateId:a,completedAtISO:y,durationSec:c,mode:o});let h=f>0?"Orgullo Saiyajin completado: +".concat(f," KI").concat(k?" +".concat(k," KI bonus"):""," ✅"):b?"Entrenamiento guardado. Cap diario alcanzado; hoy no se suma m\xe1s KI \uD83D\uDC22":"Entrenamiento guardado.";return{kiAdded:f,streak:g,bonusKi:k,message:h}})}async function f(t){await n.db.transaction("rw",n.db.settings,async()=>{let e=await u();await n.db.settings.put({...e,dailyKiCap:Math.max(10,Math.min(200,Math.round(t)))})})}async function b(t){await n.db.transaction("rw",n.db.settings,async()=>{let e=await u();await n.db.settings.put({...e,difficulty:t})})}async function p(t){await n.db.transaction("rw",n.db.settings,async()=>{let e=await u();await n.db.settings.put({...e,reduceMotion:t})})}},2694:function(t,e,a){a.d(e,{nn:function(){return s},s2:function(){return c},tu:function(){return u},e6:function(){return l}});var n=a(4635),r=a(2265);function i(t,e,a){return function(t,e,a){"function"==typeof t?(n=e||[],i=a):(n=[],i=e);var n,i,o=r.useRef({hasResult:!1,result:i,error:null}),s=r.useReducer(function(t){return t+1},0);s[0];var u=s[1],c=r.useMemo(function(){var e="function"==typeof t?t():t;if(!e||"function"!=typeof e.subscribe){if(t===e)throw TypeError("Given argument to useObservable() was neither a valid observable nor a function.");throw TypeError("Observable factory given to useObservable() did not return a valid observable.")}if(!o.current.hasResult&&"undefined"!=typeof window&&("function"!=typeof e.hasValue||e.hasValue())){if("function"==typeof e.getValue)o.current.result=e.getValue(),o.current.hasResult=!0;else{var a=e.subscribe(function(t){o.current.result=t,o.current.hasResult=!0});"function"==typeof a?a():a.unsubscribe()}}return e},n);if(r.useDebugValue(o.current.result),r.useEffect(function(){var t=c.subscribe(function(t){var e=o.current;(null!==e.error||e.result!==t)&&(e.error=null,e.result=t,e.hasResult=!0,u())},function(t){var e=o.current;e.error!==t&&(e.error=t,u())});return"function"==typeof t?t:t.unsubscribe.bind(t)},n),o.current.error)throw o.current.error;return o.current.result}(function(){return(0,n.Y1)(t)},e||[],a)}var o=a(9608);function s(){let t=i(async()=>o.db.player.get("player"),[]),e=i(async()=>o.db.settings.get("settings"),[]);return{player:t,settings:e,loading:!t||!e}}function u(t){let e=i(async()=>o.db.quests.where({dateISO:t}).toArray(),[t]),a=i(async()=>o.db.actions.where({dateISO:t}).toArray(),[t]),n=i(async()=>o.db.workouts.where({dateISO:t}).toArray(),[t]);return{questCompletions:null!=e?e:[],actions:null!=a?a:[],workouts:null!=n?n:[]}}function c(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,e=i(async()=>await o.db.actions.orderBy("createdAtISO").reverse().limit(t).toArray(),[t]);return null!=e?e:[]}function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,e=i(async()=>await o.db.workouts.orderBy("completedAtISO").reverse().limit(t).toArray(),[t]);return null!=e?e:[]}}}]);